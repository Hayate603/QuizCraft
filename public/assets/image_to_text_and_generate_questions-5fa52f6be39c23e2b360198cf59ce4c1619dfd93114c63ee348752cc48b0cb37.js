function initializeImageToTextAndGenerateQuestions(){function e(e){e.addEventListener("ajax:success",(function(t){const[s,n,r]=t.detail;if(addFlashMessage("notice",s.message),s.success)e.remove();else{const t=e.querySelector(".question-new__error-messages");s.errors&&s.errors.length>0?(t.innerHTML=s.errors.map((e=>`<li>${e}</li>`)).join(""),t.classList.add("visible")):t.classList.remove("visible")}})),e.addEventListener("ajax:error",(function(e){const[t,s,n]=e.detail;console.error("Error:",t),addFlashMessage("alert","\u8cea\u554f\u306e\u4fdd\u5b58\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}))}function t(e,t){const s=Math.random().toString(36).substr(2,9),n=document.createElement("form");return n.className="question-new__form--dynamic question-form",n.action=`/quizzes/${l}/questions`,n.method="POST",n.setAttribute("data-remote","true"),n.innerHTML=`\n      <div class="question-new__field form-field">\n        <label for="question_text_${s}" class="form-label">\u8cea\u554f\u30c6\u30ad\u30b9\u30c8</label>\n        <textarea name="question[question_text]" id="question_text_${s}" class="form-input">${e}</textarea>\n      </div>\n      <div class="question-new__field form-field">\n        <label for="correct_answer_${s}" class="form-label">\u6b63\u89e3</label>\n        <input type="text" name="question[correct_answer]" id="correct_answer_${s}" class="form-input" value="${t}">\n      </div>\n      <div class="question-new__error-messages"></div>\n      <div class="question-new__actions--dynamic form-actions">\n        <input type="submit" value="\u8cea\u554f\u3092\u4f5c\u6210" class="button button--primary">\n      </div>\n    `,n}const s=document.getElementById("text-generation-form"),n=document.getElementById("image-upload-form"),r=document.getElementById("extracted-text-area"),a=document.getElementById("generated-questions"),o=document.getElementById("submit-all-questions"),i=document.getElementById("add-question-form"),d=document.getElementById("questions-data"),c=document.getElementById("save-all-questions-form"),l=document.getElementById("question-forms-container").dataset.quizId,u=document.getElementById("image-loading-spinner"),m=document.getElementById("image-loading-message"),f=document.getElementById("text-loading-spinner"),q=document.getElementById("text-loading-message");document.querySelectorAll(".question-form").forEach((t=>e(t))),n&&(n.addEventListener("ajax:beforeSend",(function(){u.classList.remove("hidden"),m.classList.remove("hidden")})),n.addEventListener("ajax:success",(function(e){u.classList.add("hidden"),m.classList.add("hidden");const[t,s,n]=e.detail;r.value=t.text,addFlashMessage("notice",t.message||t.errors&&t.errors.join(", "))})),n.addEventListener("ajax:error",(function(e){u.classList.add("hidden"),m.classList.add("hidden");const[t,s,n]=e.detail;console.error("Error:",t),addFlashMessage("alert","\u30c6\u30ad\u30b9\u30c8\u306e\u62bd\u51fa\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}))),s&&(s.addEventListener("ajax:beforeSend",(function(){f.classList.remove("hidden"),q.classList.remove("hidden")})),s.addEventListener("ajax:success",(function(s){f.classList.add("hidden"),q.classList.add("hidden");const[n,r,o]=s.detail;a.innerHTML="",n.questions.forEach((({question:s,answer:n})=>{const r=t(s,n);a.appendChild(r),e(r)})),addFlashMessage("notice",n.message||n.errors&&n.errors.join(", "))})),s.addEventListener("ajax:error",(function(e){f.classList.add("hidden"),q.classList.add("hidden");const[t,s,n]=e.detail;console.error("Error:",t),addFlashMessage("alert","\u8cea\u554f\u306e\u751f\u6210\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}))),o.addEventListener("click",(function(e){e.preventDefault();const t=document.querySelectorAll(".question-form"),s=[];t.forEach((e=>{const t=e.querySelector('textarea[name="question[question_text]"]').value,n=e.querySelector('input[name="question[correct_answer]"]').value;s.push({question_text:t,correct_answer:n})})),d.value=JSON.stringify({questions:s}),Rails.fire(c,"submit")})),c.addEventListener("ajax:success",(function(e){const[t,s,n]=e.detail,r=document.querySelectorAll(".question-form");if(t.success)addFlashMessage("notice",t.message),a.innerHTML="",r.forEach((e=>e.reset()));else{let e=0;t.success_questions&&(e=t.success_questions.length,t.success_questions.forEach((e=>{const t=Array.from(r).find((t=>t.querySelector('textarea[name="question[question_text]"]').value===e.question_text&&t.querySelector('input[name="question[correct_answer]"]').value===e.correct_answer));t&&t.remove()}))),e>0&&addFlashMessage("notice",`${e}\u4ef6\u306e\u8cea\u554f\u304c\u6b63\u5e38\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3057\u305f\u3002`),t.errors&&t.errors.forEach((e=>{const t=Array.from(r).find((t=>t.querySelector('textarea[name="question[question_text]"]').value===e.question_text&&t.querySelector('input[name="question[correct_answer]"]').value===e.correct_answer));if(t){const s=t.querySelector(".question-new__error-messages");e.errors?(s.innerHTML=e.errors.map((e=>`<li>${e}</li>`)).join(""),s.classList.add("visible")):s.classList.remove("visible")}}))}})),c.addEventListener("ajax:error",(function(e){const[t,s,n]=e.detail;console.error("Error:",n),addFlashMessage("alert","\u8cea\u554f\u306e\u4fdd\u5b58\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})),i.addEventListener("click",(function(s){s.preventDefault();const n=t("","");a.appendChild(n),e(n)}))}import Rails from"@rails/ujs";import{addFlashMessage}from"./flash_messages";document.addEventListener("turbo:load",initializeImageToTextAndGenerateQuestions);